# E-kit

E-kit 一体化电子工具箱，STM32实现，示波器+函数发生器+...

![main](README/main.jpg)

![singal](README/singal.png)



## 基本功能 

* STM32F103 (停留在较旧的版本并停止更新，仅支持以下功能)

- [x] 基本示波器实现（包括波形判断，频率测量，峰峰值测量，占空比测量）
- [x] 任意频率正弦波输出
- [x] 多窗口支持
- [x] 集中式Log



* STM32F407

- [x] 基本示波器实现（包括波形判断，频率测量，峰峰值测量，占空比测量）

- [x] 任意频率正弦波输出

- [x] 多窗口支持

- [x] 集中式Log

- [x] 幅频特性仪移植

- [ ] 上位机通讯重构

- [x] 函数信号发生器

- [ ] 示波器触发模式

- [ ] 电池管理

  

---

# 设计文档

## 一、工作原理

### 1. 软件部分

#### 1.1 示波器部分

 

 

采用FFT得出频率，作为后续处理的前提参考

微分法首先判别是否为方波

积分法判断波形和测占空比

使用TIM4中断方式ADC取样以确保精度

超循环中循环采样及显示及其他功能

显示方案采用STemWin图形库实现；

用一个电阻式触摸屏实现按键输入与显示功能

 

 

#### 1.2 信号发生器部分



使用DMA的方法把内存中的波形数据依次传递到DAC控制器，定时器控制DMA的速度来控制输出波形的频率。DAC输出0~3.3V的电平信号再经过外围电路的转换得到-5V到+5V范围的信号并进行输出。



#### 1.3 IOT上位机部分

蓝牙串口透传模块实现。可转换实现上位机的有线无线传输。



#### 1.4 幅频特性仪部分





 

### 2. 硬件部分



#### 2.1电源部分

 2.1.USB   接口模块部分 

 2.1.2   充电蓄电模块部分 

 2.1.3   负压生成部分 

 

#### 2.2扩幅电路部分

 2.2.2   信号输入部分 

 2.2.2   信号输出部分 

 

##  二、    仪器制作过程 

###  1.   软件部分 

####  1.1   主函数部分 

 

####  1.2   屏幕部分 

1.2.1 初始化

 

1.2.2 图形界面

 

![示波器UI](README/image-20210730202408105.png)

 

1.3 信号获取与处理部分

 

1.3.1 ADC 获取数据

 

1.3.2 FFT 处理数据

 

1.3.3 信号显示

1.3.3.1 时域波形的显示

 

1.3.3.2 幅频特性的显示

 

 

 

 

1.4 信号的产生与输出部分

1.4.1 DAC产生信号

1.4.1.1 DAC 的初始化

 

1.4.1.2 DMA 传输数据

 

1.4.1.3 不同波形的产生

?                   

 

 

1.4.2上位机传输数据

1.4.2.1无线传输模块

 

1.4.2.2 上位机接收

 

 

#### 2. 硬件部分

1.1  电路设计

1.1.1 电源部分

 

1.1.2 扩幅电路部分

 

1.2  PCB 设计

 

1.3  电子元件的焊接

 

 

## 三、实验仪器的应用

### 1. 整体说明

在转置的前端是显示屏幕，可以直接在屏幕上直接触摸来对各种参数进行设置，旁边分别是信号的输入和输出端口。在装置的后端是USB电源接口和指示灯。

 

### 2. 示波器功能

![示波器UI](README/image-20210730202408105.png)



当信号经由输入端口进入仪器以后即可在屏幕上得到其波形，将对其波形进行识别并做出判断。同时显示出其峰峰值、频率，如果是自动判断为方波将自动测量占空比，或者手动点击`DR Measure`按钮也可以自动测量占空比。

对于波形显示，可以对其水平灵敏度和垂直灵敏度进行调节，也可以点击`Stop/Run`进行波形冻结。



 

### 3. 信号发生器功能

![波形发生器](README/image-20210907223205490.png)



**输出波形选择：**

可以选择输出

```c
Wave_Form_NA,     
Wave_Form_SIN,      //正弦波  ~~~~
Wave_Form_TRI,      //三角波  VVVV
Wave_Form_SQU,      //方波    _||_
Wave_Form_SAW_1,    //锯齿波1 /|/|  
Wave_Form_SAW_2,    //锯齿波2 |\|\|  
Wave_Form_RAD,      //噪波    ????
Wave_Form_DC        //直流    ----
```

**捷径配置选择：**

控制在示波器界面的捷径控制框可以改变的参数。



**输出波形参数配置：**

并且可以方便实时地改变 占空比、峰峰值、偏置电压、占空比（如果输出是方波）。



**调整步进配置：**

调整微调按钮的步进大小



**输出按钮：**

快速控制是否输出。也可通过输出按钮的颜色判断当前是否有输出。



### 4. 幅频特性仪功能

![幅频特性UI](README/image-20210730202505206.png)





### 5. 上位机传输功能

 在示波器界面选择IOT复选框，可开启上位机传输功能，上传当前屏幕显示的波形，并与屏幕刷新同步。

 













---



## 一些经验

移植cube-MX生成的工程时注意`stm32f4xx_it.c `文件也会生成一些代码

---

目前此仓库仅适合个人参考，但每次提交的工程都确保已实现部分能用

注意：采用GB2312编码

![image-20210906003413804](README/image-20210906003413804.png)
